using System;
using System.Threading.Tasks;
using Volo.Abp.Data;
using Volo.Abp.DependencyInjection;
using Volo.Abp.Domain.Repositories;
using {{.NamespaceRoot}}.Domain.Entities.{{.ModuleName}}Module;
{{- if eq .PrimaryKeyType "Guid"}}
using Volo.Abp.Guids;
{{- end}}
using Volo.Abp.Domain.Entities;
using Volo.Abp.Validation;
using FluentValidation;
using Microsoft.Extensions.Logging;
using Volo.Abp;

namespace {{.NamespaceRoot}}.Domain.Data.{{.ModuleName}}Module
{
    public class {{.EntityName}}DataSeeder : IDataSeedContributor, ITransientDependency
    {
        private readonly IRepository<{{.EntityName}}, {{.PrimaryKeyType}}> _repository;
{{- if eq .PrimaryKeyType "Guid"}}
        private readonly IGuidGenerator _guidGenerator;
{{- end}}
        private readonly ILogger<{{.EntityName}}DataSeeder> _logger;

        public {{.EntityName}}DataSeeder(
            IRepository<{{.EntityName}}, {{.PrimaryKeyType}}> repository{{if eq .PrimaryKeyType "Guid"}},
            IGuidGenerator guidGenerator{{end}},
            ILogger<{{.EntityName}}DataSeeder> logger)
        {
            _repository = repository;
{{- if eq .PrimaryKeyType "Guid"}}
            _guidGenerator = guidGenerator;
{{- end}}
            _logger = logger;
        }

        public async Task SeedAsync(DataSeedContext context)
        {
            _logger.LogInformation("Starting SeedAsync operation for {EntityName}", "{{.EntityName}}");
            
            try
            {
                if (await _repository.GetCountAsync() > 0)
                {
                    _logger.LogInformation("SeedAsync skipped for {EntityName}: data already exists", "{{.EntityName}}");
                    return;
                }

                // TODO: Add seed data
{{- if eq .PrimaryKeyType "Guid"}}
                // await _repository.InsertAsync(new {{.EntityName}}(
                //     _guidGenerator.Create(),
                //     // Add properties here
                // ), autoSave: true);
{{- else}}
                // await _repository.InsertAsync(new {{.EntityName}}(
                //     0, // ID will be auto-generated by database
                //     // Add properties here
                // ), autoSave: true);
{{- end}}
                _logger.LogInformation("Successfully completed SeedAsync operation for {EntityName}", "{{.EntityName}}");
            }
            catch (BusinessException)
            {
                throw;
            }
            catch (EntityNotFoundException)
            {
                throw;
            }
            catch (AbpValidationException)
            {
                throw;
            }
            catch (ValidationException)
            {
                throw;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Unexpected error in SeedAsync operation for {EntityName}", "{{.EntityName}}");
                throw new UserFriendlyException("An unexpected error occurred while seeding data. Please try again later.");
            }
        }
    }
}

